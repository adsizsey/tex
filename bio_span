def relaxed_span_integrity_check(dataset, id_to_label):
    """
    Checks each sample in the dataset for relaxed BIO tagging consistency.
    Allows 'O' between B_XXX and I_XXX as long as all I_XXX match the latest B_XXX.
    Returns a set of indices of invalid samples.
    """
    bad_indices = set()

    for i, sample in enumerate(dataset):
        label_ids = sample['labels']
        label_tags = [id_to_label[lid] for lid in label_ids]

        last_entity = None
        for tag in label_tags:
            if tag.startswith('B_'):
                last_entity = tag[2:]
            elif tag.startswith('I_'):
                if last_entity is None or tag[2:] != last_entity:
                    bad_indices.add(i)
                    break  # no need to check further
            elif tag == 'O':
                continue  # allowed between B and I
            else:
                # Unexpected format
                bad_indices.add(i)
                break

    return bad_indices
